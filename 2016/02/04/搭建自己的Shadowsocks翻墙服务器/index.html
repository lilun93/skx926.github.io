<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>搭建自己的Shadowsocks翻墙服务器 | AndroiOS X</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">搭建自己的Shadowsocks翻墙服务器</h1><a id="logo" href="/.">AndroiOS X</a><p class="description">孙凯旋的技术博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">搭建自己的Shadowsocks翻墙服务器</h1><div class="post-meta">2016-02-04 | <span class="categories">分类于<a href="/categories/Tools/"> Tools</a></span></div><span data-disqus-identifier="2016/02/04/搭建自己的Shadowsocks翻墙服务器/" class="disqus-comment-count"></span><div class="post-content"><p>其实现在网上已经有很多类似的文章了，这种教程对于大多数人来说可能只需要看一次就行了，但也有可能过一段时间服务器被墙了或者速度不行ping值太高需要重新在新的服务器上搭建。所以我在此把我搭建以及优化的过程纪录一下，以便不时之需。</p>
<h2 id="u4E3A_u4EC0_u4E48_u8981_u7FFB_u5899"><a href="#u4E3A_u4EC0_u4E48_u8981_u7FFB_u5899" class="headerlink" title="为什么要翻墙"></a>为什么要翻墙</h2><p>我已经想不起来我是什么时候开始翻墙了，其实我一开始翻墙就是为了多了解一些关于我党的黑历史，希望上Twitter、facebook、Google、Youtube能发现一些普通人所不知道的事情。一开始确实如我所愿，但是知道这些事情并不能改变什么，渐渐的对这些事情失去了兴趣。后来随着技术的学习，对国外的产品和技术产生了一定的崇拜，尤其是Google，但是万恶的GFW阻断了我和这些优秀的产品和技术之间的联系，所以我不得不翻墙来继续保持我和它们的联系。</p>
<h2 id="u4E3A_u4EC0_u4E48_u8981_u642D_u5EFA_u81EA_u5DF1_u7684_u7FFB_u5899_u670D_u52A1_u5668"><a href="#u4E3A_u4EC0_u4E48_u8981_u642D_u5EFA_u81EA_u5DF1_u7684_u7FFB_u5899_u670D_u52A1_u5668" class="headerlink" title="为什么要搭建自己的翻墙服务器"></a>为什么要搭建自己的翻墙服务器</h2><p>翻墙有很多的渠道和方法，大多数人嫌麻烦，购买一个商业的VPN就行了，这个确实不失为一个好方法。但是我们伟大的墙随着时间的推移变得越来越智能，它已经能够通过对数据包的深度监测发现你是否在翻墙，从而阻断你的连接。常见的例如PPTP、L2TP之类的VPN协议特征比较明显，很容易被墙发现。根据我的使用体验，基本上连上几分钟后就断开了，有时候甚至连接不上。而Shadowsocks是基于一种自定义的协议，相对而言墙更难检测，所以也较为稳定。</p>
<p>其实现在也有很多网站提供Shadowsocks服务，但是鱼龙混杂，安全性无法得到保障，你的所有数据包都会暴漏给Shadowsocks服务器，很容易泄漏一些账号密码之类的敏感信息。其次是速度和稳定性的问题，有一些免费的账号使用人数太多，速度和稳定性都无法得到保障。即便是付费购买的账号，由于VPS提供商对于流量和带宽的限制，而商家需要从中获利，所以永远没有自己搭建的服务器实在。</p>
<h2 id="u9009_u62E9_u548C_u8D2D_u4E70VPS_u670D_u52A1_u5668"><a href="#u9009_u62E9_u548C_u8D2D_u4E70VPS_u670D_u52A1_u5668" class="headerlink" title="选择和购买VPS服务器"></a>选择和购买VPS服务器</h2><blockquote>
<p>作为一个完美主义者，一旦使用了VPS，就会掉进追求更快速度和最低延迟的坑。</p>
</blockquote>
<h3 id="u4E00_u4E9BVPS_u670D_u52A1_u63D0_u4F9B_u5546_u7684_u4ECB_u7ECD"><a href="#u4E00_u4E9BVPS_u670D_u52A1_u63D0_u4F9B_u5546_u7684_u4ECB_u7ECD" class="headerlink" title="一些VPS服务提供商的介绍"></a>一些VPS服务提供商的介绍</h3><h4 id="Bandwagon"><a href="#Bandwagon" class="headerlink" title="Bandwagon"></a>Bandwagon</h4><p>一开始我使用的是<a href="https://bandwagonhost.com/cart.php?a=add&amp;pid=19" target="_blank" rel="external">Bandwagon</a>(搬瓦工)的3.99美元一年的VPS，这个VPS的特点就是便宜，但是它的配置很低，只有64M的内存，不过这个对于搭建一个个人使用的Shadowsocks服务器也够用了。搬瓦工的VPS的另一个好处是它的控制面板上自带了一键配置Shadowsocks的功能，这对于新手来说很好。如果你舍不得花钱，这是个不错的选择，但是不幸的是，由于卖的太火爆，已经没有存货了。</p>
<h4 id="Linode"><a href="#Linode" class="headerlink" title="Linode"></a>Linode</h4><p>搬瓦工便宜，但是速度不怎么用，用它来上上Google搜索一下资料倒是没有什么问题，但是如果想看Youtube的视频那就算了吧。于是乎我又掉进了<a href="https://manager.linode.com/linodes/add?group=" target="_blank" rel="external">Linode</a>的大坑。Linode在全球有多个数据中心，其中日本的机房对于中国大陆的用户来说最爽，延时大概是在70ms左右，新加坡机房也不错，延时在140ms左右。比较悲剧的是由于日本机房太抢手，新注册的账号现在只能购买除日本机房以外的机房的VPS。延时多那么几十号秒其实影响不大，对于看视频来说最主要的还是带宽和稳定性，所以新加坡机房也挺不错，由于我注册上时间也比较晚，所以只好购买新加坡机房的VPS。根据我和朋友使用的效果来看，只要你的带宽足够，看Youtube 1080p的视频不是问题，甚至4k的视频也是可以的！但是这个是建立在你在服务器上安装了<a href="http://www.serverspeeder.com/" target="_blank" rel="external">锐速</a>的基础之上，这个后面我会详说。Linode最便宜的服务器是10美元每月，对于个人来说太贵，找几个人合租是一个不错的选择。如果在朋友当中不好找，你可以到Google Plus上的Shadowsocks相关的社群里逛逛或者发帖留言，上面有很多活跃的分子。</p>
<h4 id="Softlayer"><a href="#Softlayer" class="headerlink" title="Softlayer"></a>Softlayer</h4><p>不知道是不是墙越来越牛逼的缘故，Linode用着用着有时候会出现几分钟连接不上的问题。而且我现在用的这个新加坡机房的服务器在深圳移动4G的网络下怎么也连接不上，电信的WiFi下正常。所以我又有了第三次探索。偶然听朋友说<a href="http://www.softlayer.com/" target="_blank" rel="external">Softlayer</a>香港服务器不错，我就上网查了一下发现它被IBM收购了，既然是IBM出品，那质量应该有所保证。我通过<a href="http://www.softlayer.com/info/free-cloud" target="_blank" rel="external">试用链接</a>获取了一个月的试用机会，发现速度ping值确实低的离谱，很多时候只有几号秒的延时！可能因为机房在香港，我在深圳的缘故。速度也还不错，感觉没有Linode快，但是贵的离谱，最便宜的配置也需要27美金每月。如果你不是土豪的话，试用一个月就行了。</p>
<h4 id="Digital_Ocean_u548CVultr"><a href="#Digital_Ocean_u548CVultr" class="headerlink" title="Digital Ocean和Vultr"></a>Digital Ocean和Vultr</h4><p><a href="https://www.digitalocean.com/?refcode=98b3c0c5a987" target="_blank" rel="external">Digital Ocean</a>和<a href="https://www.vultr.com/" target="_blank" rel="external">Vultr</a>都提供配置差不多的最低每月5美金的VPS，区别就是Vultr有日本的机房可以选择，但是根据我的使用体验，Vultr的日本机房的ping值也要200ms左右，但是稳定性不错，不会出现Linode那种间歇性连不上和移动4G连不上的问题，在使用锐速优化了之后看Youtube 720p的视频问题不大，1080p的就有些吃力了。很多网上的文章说Digital Ocean的速度不错，但是根据我个人的使用体验来说，即便是使用锐速优化过之后，也无法流畅的观看Youtube 720p的视频，甚至480p的也看不了。</p>
<h3 id="u8D2D_u4E70VPS"><a href="#u8D2D_u4E70VPS" class="headerlink" title="购买VPS"></a>购买VPS</h3><p>购买的过程我就不多说了，大体都是注册账号、绑定信用卡或者Paypal等支付方式、选择VPS、购买。</p>
<h2 id="u5B89_u88C5Shadowsocks"><a href="#u5B89_u88C5Shadowsocks" class="headerlink" title="安装Shadowsocks"></a>安装Shadowsocks</h2><p>成功购买VPS之后你应该已经能够获取到你的VPS的IP地址，root账号的密码。打开终端，使用ssh登录服务器：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh root@你的VPS的IP地址</span><br></pre></td></tr></table></figure>
<p>然后会提示你输入密码，密码不会显示，输入完成后回车即可。登录成功之后依次输入下面的命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ yum install epel-release</span><br><span class="line">$ yum update$ easy_install pip$ pip install shadowsocks</span><br></pre></td></tr></table></figure>
<p>等待安装完成之后我们需要配置一下Shadowsocks的账号，使用下面的命令新建一个Shadowsocks的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>
<p>这时点击i键进入编辑模式，然后将下面的内容复制粘贴过去：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">server</span>":<span class="value"><span class="string">"0.0.0.0"</span></span>,</span><br><span class="line">    "<span class="attribute">port_password</span>": <span class="value">&#123;</span><br><span class="line">        "<span class="attribute">9990</span>":<span class="value"><span class="string">"password0"</span></span>,</span><br><span class="line">        "<span class="attribute">9989</span>":<span class="value"><span class="string">"password1"</span></span><br><span class="line">    </span>&#125;</span>,</span><br><span class="line">    "<span class="attribute">timeout</span>":<span class="value"><span class="number">600</span></span>,</span><br><span class="line">    "<span class="attribute">method</span>":<span class="value"><span class="string">"aes-256-cfb"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>port_password就是端口和它所对应的密码，这里可以使用多个端口和密码，你可以把它分配给不同的人，每个人使用单独的端口。</li>
</ul>
<p>复制粘贴完了之后按一下ESC键然后输入:wq对文件进行保存并退出vi编辑模式。然后我们通过下面的命令启动Shadowsocks服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssserver -c /etc/shadowsocks.json <span class="operator">-d</span> start</span><br></pre></td></tr></table></figure>
<p>如果你需要停止或者重启Shadowsocks服务，只需要把后面的start替换成stop或者restart。</p>
<p>这样我们的Shadowsocks服务器就搭建成功了。你可以在手机或电脑上使用上面IP、端口和密码连接感受一下速度。如果速度不咋地的话（一般来说肯定不咋地），那就需要安装锐速来优化一下速度。</p>
<h2 id="u4F7F_u7528_u9510_u901F_u4F18_u5316Shadowsocks"><a href="#u4F7F_u7528_u9510_u901F_u4F18_u5316Shadowsocks" class="headerlink" title="使用锐速优化Shadowsocks"></a>使用锐速优化Shadowsocks</h2><p>锐速是一款非常不错的TCP底层加速软件，可以非常方便快速地完成服务器网络的优化，配合 ShadowSocks 效果奇佳。目前锐速官方也出了永久免费版本，适用带宽20M的加速连接，个人使用是足够了。如果需要，先要在锐速官网注册个账户（这两天官网暂时关闭了注册和安装，不知道什么时候会恢复）。</p>
<ul>
<li>搬瓦工的服务器是OpenVZ架构，无法修改内核参数，所以无法使用锐速，只有Linode、Digital Ocean和Vultr等KVM或XEN架构的服务器可以使用。</li>
</ul>
<p>锐速只支持有限的Linux内核版本，安装之前最好查看一下自己的内核版本看是不是在这个<a href="http://my.serverspeeder.com/ls.do?m=availables" target="_blank" rel="external">列表</a>里面。如果没有，需要更换内核。</p>
<p>确定自己的内核在支持列表里面之后就可以使用下面的命令进行安装了：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ wget http://my.serverspeeder.com/d/ls/serverSpeederInstaller.tar.gz</span><br><span class="line">$ tar xzvf serverSpeederInstaller.tar.gz</span><br><span class="line">$ bash serverSpeederInstaller.sh</span><br></pre></td></tr></table></figure>
<p>输入在官网注册的账号和密码，参数设置直接回车默认即可，最后两项输入y设置为开机启动和立即启动。然后可以通过下面的命令查看锐速是否成功运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ lsmod</span><br></pre></td></tr></table></figure>
<p>如果能够看到一个叫appex0的模块在运行，就说明锐速已经安装并启动成功。</p>
<p>为了发挥锐速的最大效力，我们需要再修改一下锐速的几个参数，使用下面的命令打开锐速的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vi /serverspeeder/etc/config</span><br></pre></td></tr></table></figure>
<p>点击i进入编辑模式，然后将其中的rsc、advinacc和maxmode分别修改为1，然后点击ESC键退出编辑模式，然后输入:wq进行保存。保存之后使用下面的命令重启锐速:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service serverSpeeder restart</span><br></pre></td></tr></table></figure>
<p>至此你可以畅快的刷推、看Youtube的视频了。Cheers！</p>
</div><div class="tags"><a href="/tags/Shadowsocks/">Shadowsocks</a><a href="/tags/VPS/">VPS</a><a href="/tags/翻墙/">翻墙</a></div><div class="post-nav"><a href="/2016/01/26/利用Hexo和Github-Pages搭建个人博客/" class="next">利用Hexo和Github Pages搭建个人博客<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'androiosx';
var disqus_identifier = '2016/02/04/搭建自己的Shadowsocks翻墙服务器/';
var disqus_title = '搭建自己的Shadowsocks翻墙服务器';
var disqus_url = 'http://AndroiOSX.com/2016/02/04/搭建自己的Shadowsocks翻墙服务器/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//androiosx.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://AndroiOSX.com"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Mac技巧/">Mac技巧</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS开发/">iOS开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/闲言碎语/">闲言碎语</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/Shadowsocks/" style="font-size: 15px;">Shadowsocks</a> <a href="/tags/翻墙/" style="font-size: 15px;">翻墙</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/DNSPod/" style="font-size: 15px;">DNSPod</a> <a href="/tags/VPS/" style="font-size: 15px;">VPS</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/02/04/搭建自己的Shadowsocks翻墙服务器/">搭建自己的Shadowsocks翻墙服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/利用Hexo和Github-Pages搭建个人博客/">利用Hexo和Github Pages搭建个人博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/04/Mac如何生成Unix可执行文件/">Mac如何生成Unix可执行文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/04/对extern的理解/">对extern的理解</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/14/我为什么写博客/">我为什么写博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/13/iOS图片圆角实现和性能优化/">iOS图片圆角实现和性能优化</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//androiosx.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://blog.devtang.com/" title="唐巧的技术博客" target="_blank">唐巧的技术博客</a><ul></ul><a href="http://blog.ibireme.com/" title="Garan no Dou" target="_blank">Garan no Dou</a><ul></ul><a href="http://blog.sunnyxx.com/" title="sunnyxx" target="_blank">sunnyxx</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">AndroiOS X.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-73055515-1','auto');ga('send','pageview');
</script><script src="/js/codeblock-resizer.js" type="text/javascript"></script>
<script src="/js/smartresize.js" type="text/javascript"></script></div></body></html>